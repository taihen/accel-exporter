#!/usr/bin/make -f

export DH_VERBOSE = 1

%:
	dh $@

override_dh_auto_build:
	# Use pre-built binary from dist/ directory
	test -f dist/accel-exporter || (echo "Pre-built binary not found in dist/accel-exporter" && exit 1)
	cp dist/accel-exporter accel-exporter

override_dh_auto_test:
	# Skip tests for pre-built binary packaging

override_dh_dwz:
	# Skip dwz compression for Go binaries (causes issues with static binaries)

override_dh_auto_install:
	# Install binary
	mkdir -p debian/accel-exporter/usr/bin
	install -m 755 accel-exporter debian/accel-exporter/usr/bin/
	
	# Install systemd service file
	mkdir -p debian/accel-exporter/lib/systemd/system
	install -m 644 debian/accel-exporter.service debian/accel-exporter/lib/systemd/system/

override_dh_auto_clean:
	rm -f accel-exporter
	rm -rf _build

.PHONY: override_dh_auto_build override_dh_auto_test override_dh_auto_install override_dh_auto_clean